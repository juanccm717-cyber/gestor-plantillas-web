{% extends "base.html" %}

{% block title %}Detalle de Plantilla - {{ plantilla.tipo_atencion }}{% endblock %}

{% block head %}
<style>
    /* Estilos personalizados para la vista de detalle */
    .section-card {
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: .5rem;
        margin-bottom: 1.5rem;
        padding: 1.5rem;
    }
    .section-title {
        color: #00ff8c; /* Color neón verde */
        border-bottom: 1px solid #444;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .item-count-badge {
        font-size: 0.8em;
        background-color: #343a40;
    }
    .quill-content-dark {
        background-color: #212529; /* Fondo oscuro para el contenido de Quill */
        color: #f8f9fa; /* Texto claro */
        border-radius: .3rem;
        padding: 1rem;
        border: 1px solid #444;
    }

    .text-muted.fst-italic {
        color: rgba(255, 255, 255, 0.5) !important;
    }

    .badge.rounded-pill {
        white-space: normal;
        text-align: left;
        line-height: 1.2;
        padding: .4em .8em;
    }

    @media print {
        body {
            filter: grayscale(100%);
            -webkit-filter: grayscale(100%);
        }
        .card-footer {
            display: none !important;
        }
        .card, .section-card, .quill-content-dark {
            background-color: #ffffff !important;
            color: #000000 !important;
            border: 1px solid #ccc !important;
        }
        .text-white, .section-title {
             color: #000000 !important;
        }
        .section-title {
            border-bottom: 1px solid #ccc !important;
        }
        .badge {
            border: 1px solid #000 !important;
            color: #000 !important;
            background-color: #fff !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="card bg-dark text-white border-secondary shadow-lg">
        <div class="card-header bg-dark-accent text-center py-3">
            <h2 class="card-title mb-0 display-6">{{ plantilla.tipo_atencion }}</h2>
        </div>
        <div class="card-body p-4">
            
            <!-- SECCIÓN 1: INFORMACIÓN GENERAL -->
            <div class="section-card">
                <h4 class="section-title">
                    <span><i class="fas fa-info-circle me-2"></i>Información General</span>
                </h4>
                <p><strong>ID de Plantilla:</strong> {{ plantilla.id }}</p>
                <p><strong>Código Prestacional:</strong> <span class="badge bg-primary fs-6">{{ plantilla.codigo_prestacional }}</span></p>
                <p><strong>Descripción Prestacional:</strong> {{ plantilla.descripcion_prestacional }}</p>
            </div>

            <!-- MACRO MEJORADO PARA MOSTRAR PÍLDORAS -->
            {% macro display_pills_section(title, items, icon, pill_color='info') %}
            <div class="section-card">
                <h5 class="section-title">
                    <span><i class="fas {{ icon }} me-2"></i>{{ title }}</span>
                    <span class="badge item-count-badge">{{ items|length if items else 0 }}</span>
                </h5>
                <div>
                    {% if items and items|length > 0 %}
                        {% for item in items %}
                            <span class="badge rounded-pill text-bg-{{ pill_color }} me-1 mb-1 fs-6 fw-normal">{{ item }}</span>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted fst-italic">No se han especificado elementos.</p>
                    {% endif %}
                </div>
            </div>
            {% endmacro %}

            <div class="row">
                <div class="col-lg-6">
                    {{ display_pills_section('Actividades Preventivas', plantilla.actividades_preventivas, 'fa-shield-alt', 'success') }}
                    {{ display_pills_section('Diagnóstico Principal', plantilla.diagnostico_principal, 'fa-stethoscope', 'danger') }}
                    {{ display_pills_section('Diagnósticos Excluyentes', plantilla.diagnosticos_excluyentes, 'fa-times-circle', 'warning') }}
                    {{ display_pills_section('Diagnósticos Complementarios', plantilla.diagnosticos_complementarios, 'fa-plus-circle', 'info') }}
                </div>
                <div class="col-lg-6">
                    {{ display_pills_section('Medicamentos Relacionados', plantilla.medicamentos_relacionados, 'fa-pills', 'primary') }}
                    {{ display_pills_section('Insumos Relacionados', plantilla.insumos_relacionados, 'fa-box', 'secondary') }}
                    {{ display_pills_section('Procedimientos Obligatorios', plantilla.procedimientos_obligatorios, 'fa-check-circle', 'success') }}
                    {{ display_pills_section('Procedimientos Excluyentes', plantilla.procedimientos_excluyentes, 'fa-ban', 'warning') }}
                    {{ display_pills_section('Otros Procedimientos', plantilla.otros_procedimientos, 'fa-tasks', 'info') }}
                </div>
            </div>
            
            <!-- SECCIÓN DE OBSERVACIONES -->
            {% if plantilla.observaciones %}
            <div class="section-card">
                <h4 class="section-title">
                    <span><i class="fas fa-eye me-2"></i>Observaciones</span>
                </h4>
                <div class="quill-content-dark">
                    {{ plantilla.observaciones | safe }}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- ====================================================== -->
        <!--             PIE DE TARJETA CON CORRECCIÓN              -->
        <!-- ====================================================== -->
        <div class="card-footer text-center bg-dark-accent py-3">
            <a href="{{ url_for('ver_plantillas') }}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Volver</a>
            <a href="{{ url_for('descargar_pdf_plantilla', plantilla_id=plantilla.id) }}" class="btn btn-success"><i class="fas fa-file-pdf me-2"></i>Descargar PDF</a>
            
            <!-- Condición de seguridad para el botón Editar -->
            {% if session.role == 'administrador' %}
            <a href="{{ url_for('plantillas', modo='editar', id=plantilla.id) }}" class="btn btn-primary"><i class="fas fa-edit me-2"></i>Editar</a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
