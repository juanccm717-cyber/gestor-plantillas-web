{% extends "base.html" %}

{% block title %}Calculadora de IMC{% endblock %}

{% block head %}
<style>
    /* Estilos para la nueva barra de progreso y su indicador */
    .imc-scale-container {
        position: relative;
        margin-top: 1.5rem;
        padding-bottom: 2.5rem; 
    }
    .imc-indicator {
        position: absolute;
        bottom: 20px;
        width: 2px;
        height: 30px;
        background-color: #fff;
        transform: translateX(-50%);
        transition: left 0.5s ease-out;
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
        border-radius: 1px;
    }
    .imc-indicator-label {
        position: absolute;
        bottom: -5px;
        font-size: 0.8rem;
        color: #fff;
        transform: translateX(-50%);
        transition: left 0.5s ease-out;
        white-space: nowrap;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card bg-dark text-white border-secondary shadow-lg">
                <div class="card-header bg-dark-accent text-center py-3">
                    <h2 class="card-title mb-0"><i class="fas fa-calculator me-2"></i>Calculadora de IMC</h2>
                </div>
                <div class="card-body p-4">
                    <div class="mb-3">
                        <label for="peso" class="form-label">Peso (en kilogramos)</label>
                        <input type="number" class="form-control" id="peso" placeholder="Ej: 70.5">
                    </div>
                    <div class="mb-3">
                        <label for="talla" class="form-label">Talla (en centímetros)</label>
                        <input type="number" class="form-control" id="talla" placeholder="Ej: 175">
                    </div>                  
                    <div id="resultado-area" class="mt-4 text-center" style="display: none;">
                        <hr>
                        <h4>Resultado</h4>
                        <p class="display-4" id="imc-valor"></p>
                        <p class="fs-4" id="imc-interpretacion"></p>

                        <!-- INICIO DE LA MEJORA VISUAL (BARRA) -->
                        <div class="imc-scale-container">
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 25%"></div>
                                <div class="progress-bar bg-success" role="progressbar" style="width: 25%"></div>
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 25%"></div>
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 25%"></div>
                            </div>
                            <div id="indicator-container"></div>
                        </div>
                        <!-- FIN DE LA MEJORA VISUAL (BARRA) -->

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const inputPeso = document.getElementById('peso');
    const inputTalla = document.getElementById('talla');
    const resultadoArea = document.getElementById('resultado-area');
    const imcValor = document.getElementById('imc-valor');
    const imcInterpretacion = document.getElementById('imc-interpretacion');

    function calcularIMC() {
        const peso = parseFloat(inputPeso.value);
        const tallaCm = parseFloat(inputTalla.value);

        if (isNaN(peso) || isNaN(tallaCm) || peso <= 0 || tallaCm <= 0) {
            resultadoArea.style.display = 'none';
            return;
        }

        const tallaM = tallaCm / 100;
        const imc = peso / (tallaM * tallaM);
        const imcRedondeado = imc.toFixed(2);

        let interpretacion = '';
        let colorClase = '';

        if (imc < 18.5) {
            interpretacion = 'Bajo Peso';
            colorClase = 'text-info';
        } else if (imc >= 18.5 && imc < 25) {
            interpretacion = 'Peso Normal';
            colorClase = 'text-success';
        } else if (imc >= 25 && imc < 30) {
            interpretacion = 'Sobrepeso';
            colorClase = 'text-warning';
        } else {
            interpretacion = 'Obesidad';
            colorClase = 'text-danger';
        }

        imcValor.innerText = imcRedondeado;
        imcInterpretacion.innerText = interpretacion;
        imcInterpretacion.className = 'fs-4 ' + colorClase;
        
        // LÓGICA PARA POSICIONAR EL INDICADOR
        const indicatorContainer = document.getElementById('indicator-container');
        const minIMC = 15;
        const maxIMC = 40;
        let percentPosition = ((imc - minIMC) / (maxIMC - minIMC)) * 100;
        percentPosition = Math.max(0, Math.min(100, percentPosition));

        indicatorContainer.innerHTML = `
            <div class="imc-indicator" style="left: ${percentPosition}%;"></div>
            <div class="imc-indicator-label" style="left: ${percentPosition}%;">Tú estás aquí</div>
        `;
        
        resultadoArea.style.display = 'block';
    }

    inputPeso.addEventListener('input', calcularIMC);
    inputTalla.addEventListener('input', calcularIMC);
</script>
{% endblock %}
