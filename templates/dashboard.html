{% extends "base.html" %}

{% block title %}Dashboard de Métricas{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card bg-dark text-white border-secondary shadow-lg">
        <div class="card-header bg-dark-accent d-flex justify-content-between align-items-center py-3">
            <h2 class="card-title mb-0"><i class="bi bi-bar-chart-line-fill me-2"></i>Dashboard de Métricas</h2>
            <a href="{{ url_for('menu') }}" class="btn btn-sm btn-secondary"><i class="bi bi-arrow-left me-1"></i>Volver al Menú</a>
        </div>

        <div class="card-body p-4">
            <div class="row">
                <!-- Métrica 1: Total de Logins -->
                <div class="col-md-4">
                    <div class="card text-white bg-primary mb-3 text-center">
                        <div class="card-header">Total de Inicios de Sesión</div>
                        <div class="card-body">
                            <h1 class="card-title display-4" id="totalLogins">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                            </h1>
                        </div>
                    </div>
                </div>

                <!-- Aquí añadiremos más tarjetas de métricas en el futuro -->

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const totalLoginsElement = document.getElementById('totalLogins');

        fetch("{{ url_for('dashboard_data') }}")
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    totalLoginsElement.textContent = 'Error';
                    console.error('Error al cargar datos del dashboard:', data.error);
                } else {
                    // Actualizamos el contador de logins
                    totalLoginsElement.textContent = data.total_logins;
                }
            })
            .catch(error => {
                totalLoginsElement.textContent = 'Error';
                console.error('Error de red:', error);
            });
    });
</script>
{% endblock %}
